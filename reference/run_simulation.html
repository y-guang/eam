<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run a simulation with specified configuration — run_simulation • eam</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Run a simulation with specified configuration — run_simulation"><meta name="description" content="This function runs a complete simulation based on the provided
eam_simulation_config object, which is generated by the
new_simulation_config function."><meta property="og:description" content="This function runs a complete simulation based on the provided
eam_simulation_config object, which is generated by the
new_simulation_config function."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">eam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/00-framework-overview.html">Overview of the EAM Framework</a></li>
    <li><a class="dropdown-item" href="../articles/10-minimal-working-example.html">Getting Started: A Minimal Working Example</a></li>
    <li><a class="dropdown-item" href="../articles/20-models-in-eam.html">Models in eam</a></li>
    <li><a class="dropdown-item" href="../articles/30-empirical-example.html">An Empirical Example: Simulation-Based Inference for Free Recall</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Developer Guide</h6></li>
    <li><a class="dropdown-item" href="../articles/developer-guide.html">Developer Guide</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Chinese Translation</h6></li>
    <li><a class="dropdown-item" href="../articles/about-zh-translation.html">About Chinese Translation</a></li>
    <li><a class="dropdown-item" href="../articles/developer-guide.zh.html">开发人员引导</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/y-guang/eam/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Run a simulation with specified configuration</h1>
      <small class="dont-index">Source: <a href="https://github.com/y-guang/eam/blob/main/R/simulation.R" class="external-link"><code>R/simulation.R</code></a></small>
      <div class="d-none name"><code>run_simulation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function runs a complete simulation based on the provided
eam_simulation_config object, which is generated by the
<code><a href="new_simulation_config.html">new_simulation_config</a></code> function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_simulation</span><span class="op">(</span><span class="va">config</span>, output_dir <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-config">config<a class="anchor" aria-label="anchor" href="#arg-config"></a></dt>
<dd><p>A eam_simulation_config object containing all simulation
parameters, you should use <code><a href="new_simulation_config.html">new_simulation_config</a></code> to create one.</p></dd>


<dt id="arg-output-dir">output_dir<a class="anchor" aria-label="anchor" href="#arg-output-dir"></a></dt>
<dd><p>The directory to save out-of-core results (optional,
will use temp directory if not provided)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A S3 object of class eam_simulation_output containing the output
information</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function uses an out-of-core approach to handle potentially large
simulation results. Instead of returning a data frame directly, it persists
the data to disk and returns an <code>eam_simulation_output</code> object that
contains metadata and file system paths.</p>
<p>To access the simulation data, use the following methods on the returned
object:</p><ul><li><p><code>open_dataset()</code> - Returns an Arrow Dataset containing the
  simulation results, e.g. <code>sim_output$open_dataset()</code></p></li>
<li><p><code>open_evaluated_conditions()</code> - Returns an Arrow Dataset
  containing the evaluated condition parameters, e.g.
  <code>sim_output$open_evaluated_conditions()</code></p></li>
</ul><p>Both methods return Arrow Dataset objects rather than data frames, allowing
for efficient querying and filtering before loading data into memory. To
convert to a data frame, use <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">dplyr::collect()</a></code> or
<code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code>.</p>
<p>Throughout this package, the <code>eam_simulation_output</code> object is used as
the standard parameter for downstream analysis functions, rather than
passing Arrow objects or data frames directly.</p>
<p>For multi-item backends, at each discrete time point, only one item can
reach the threshold.
The precision of this detection depends on the <code>dt</code>
parameter. This design choice was made for performance considerations. For
almost all experimental scenarios, it is negligible.
But users should be aware of this limitation, if it is critical, try to
increase the temporal resolution by reducing <code>dt</code>.
For implementation details,
refer to the backend source code (<code>accumulate_evidence_*</code> functions).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Define formulas for the simulation</span></span></span>
<span class="r-in"><span><span class="va">prior_formulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">V</span> <span class="op">~</span> <span class="fu">distributional</span><span class="fu">::</span><span class="fu"><a href="https://pkg.mitchelloharawild.com/distributional/reference/dist_uniform.html" class="external-link">dist_uniform</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1.0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">ndt</span> <span class="op">~</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>  <span class="va">noise_coef</span> <span class="op">~</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">between_trial_formulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">item_formulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">A_upper</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  <span class="va">A_lower</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>  <span class="va">V</span> <span class="op">~</span> <span class="va">V</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define noise factory</span></span></span>
<span class="r-in"><span><span class="va">noise_factory</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">context</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">noise_coef</span> <span class="op">&lt;-</span> <span class="va">context</span><span class="op">$</span><span class="va">noise_coef</span></span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">dt</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">noise_coef</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create configuration</span></span></span>
<span class="r-in"><span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu"><a href="new_simulation_config.html">new_simulation_config</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  prior_formulas <span class="op">=</span> <span class="va">prior_formulas</span>,</span></span>
<span class="r-in"><span>  between_trial_formulas <span class="op">=</span> <span class="va">between_trial_formulas</span>,</span></span>
<span class="r-in"><span>  item_formulas <span class="op">=</span> <span class="va">item_formulas</span>,</span></span>
<span class="r-in"><span>  n_conditions <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  n_trials_per_condition <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  n_items <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  max_reached <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  max_t <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  dt <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>  noise_mechanism <span class="op">=</span> <span class="st">"add"</span>,</span></span>
<span class="r-in"><span>  noise_factory <span class="op">=</span> <span class="va">noise_factory</span>,</span></span>
<span class="r-in"><span>  model <span class="op">=</span> <span class="st">"ddm"</span>,</span></span>
<span class="r-in"><span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run simulation</span></span></span>
<span class="r-in"><span><span class="va">sim_output</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span><span class="va">config</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in accumulate_evidence_ddm_2b(item_params$A_upper, item_params$A_lower,     item_params$V, Z, item_params$ndt, max_t, dt, max_reached,     noise_mechanism, noise_fun):</span> could not find function "accumulate_evidence_ddm_2b"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access results</span></span></span>
<span class="r-in"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">sim_output</span><span class="op">$</span><span class="fu">open_dataset</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'sim_output' not found</span>
<span class="r-in"><span><span class="va">dataset</span> <span class="co"># an arrow dataset object</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'dataset' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># if you want to load it into memory, you can use:</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'dataset' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 function (x, df1, df2, ncp, log = FALSE)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 {                                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     if (missing(ncp))                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         .Call(C_df, x, df1, df2, log)       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     else .Call(C_dnf, x, df1, df2, ncp, log)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 }                                           </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access evaluated condition parameters</span></span></span>
<span class="r-in"><span><span class="va">cond_dataset</span> <span class="op">&lt;-</span> <span class="va">sim_output</span><span class="op">$</span><span class="fu">open_evaluated_conditions</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'sim_output' not found</span>
<span class="r-in"><span><span class="va">df_cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">cond_dataset</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'cond_dataset' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_cond</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'df_cond' not found</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Guangyu Zhu, Guang Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

